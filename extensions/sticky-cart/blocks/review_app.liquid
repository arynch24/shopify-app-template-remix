<div
  class="review-widget"
  id="review-widget"
  data-shop="{{ shop.permanent_domain }}"
  data-product-id="{{ product.id }}"
>
  <div id="loading" style="text-align: center; padding: 40px; color: #6c757d;">Loading reviews...</div>
  <div class="widget-header" id="widgetHeader" style="display: none;">
    <div class="rating-summary">
      <div class="overall-rating">
        <div class="rating-number" id="overallRating">0.0</div>
        <div class="stars" id="overallStars"></div>
        <div class="review-count" id="reviewCount">0 reviews</div>
      </div>
      <div class="rating-breakdown" id="ratingBreakdown">
        <div class="rating-row">
          <span class="rating-label">5 ★</span>
          <div class="rating-bar">
            <div class="rating-fill" id="rating5Fill" style="width: 0%"></div>
          </div>
          <span class="rating-count" id="rating5Count">(0)</span>
        </div>
        <div class="rating-row">
          <span class="rating-label">4 ★</span>
          <div class="rating-bar">
            <div class="rating-fill" id="rating4Fill" style="width: 0%"></div>
          </div>
          <span class="rating-count" id="rating4Count">(0)</span>
        </div>
        <div class="rating-row">
          <span class="rating-label">3 ★</span>
          <div class="rating-bar">
            <div class="rating-fill" id="rating3Fill" style="width: 0%"></div>
          </div>
          <span class="rating-count" id="rating3Count">(0)</span>
        </div>
        <div class="rating-row">
          <span class="rating-label">2 ★</span>
          <div class="rating-bar">
            <div class="rating-fill" id="rating2Fill" style="width: 0%"></div>
          </div>
          <span class="rating-count" id="rating2Count">(0)</span>
        </div>
        <div class="rating-row">
          <span class="rating-label">1 ★</span>
          <div class="rating-bar">
            <div class="rating-fill" id="rating1Fill" style="width: 0%"></div>
          </div>
          <span class="rating-count" id="rating1Count">(0)</span>
        </div>
      </div>
    </div>
    <div class="write-review-section">
      <span class="share-text">Share your experience</span>
      <button class="write-review-btn" onclick="toggleReviewForm()">Write a Review</button>
    </div>
  </div>

  <div class="review-form" id="reviewForm">
    <form id="submitReviewForm">
      <div class="form-group">
        <label class="form-label">Rating</label>
        <div class="rating-input" id="ratingInput">
          <span class="star" data-rating="1">★</span>
          <span class="star" data-rating="2">★</span>
          <span class="star" data-rating="3">★</span>
          <span class="star" data-rating="4">★</span>
          <span class="star" data-rating="5">★</span>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label" for="reviewerName">Name*</label>
        <input type="text" id="reviewerName" name="author" class="form-input" required>
      </div>
      <div class="form-group">
        <label class="form-label" for="reviewerEmail">E-mail</label>
        <input type="email" id="reviewerEmail" name="email" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label" for="reviewContent">Review*</label>
        <textarea id="reviewContent" name="content" class="form-input form-textarea" required></textarea>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="toggleReviewForm()">Cancel</button>
        <button type="submit" class="btn btn-primary">Submit Review</button>
      </div>
    </form>
  </div>

  <div class="reviews-list" id="reviewsList">
    <!-- Reviews will be loaded dynamically -->
  </div>
</div>

<link rel="stylesheet" href="{{ 'style.css' | asset_url }}">
<script src="{{ 'embed.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Review Widget",
  "target": "",
  "settings": [
    {
      "type": "text",
      "id": "widget_title",
      "default": "Customer Reviews",
      "label": "Widget Title"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": true,
      "label": "Show Average Rating"
    },
    {
      "type": "checkbox",
      "id": "show_review_count",
      "default": true,
      "label": "Show Review Count"
    },
    {
      "type": "color",
      "id": "widget_bg_color",
      "default": "#f9f9f9",
      "label": "Widget Background Color"
    },
    {
      "type": "color",
      "id": "widget_text_color",
      "default": "#333333",
      "label": "Widget Text Color"
    }
  ]
}
{% endschema %}
